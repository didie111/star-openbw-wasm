========================================
스타클론 프로젝트 코드 흐름 분석
========================================

1. 전체 아키텍처 개요
   ├── OpenBW 엔진 (bwgame.h)
   ├── 게임 로직 (game_logic.cpp/h)
   ├── 플레이어 입력 (player_input.cpp/h)
   ├── UI 렌더링 (ui_custom.h, ui_starcraft_panel.h)
   └── 메인 루프 (main.cpp)

2. 메인 루프 흐름 (main.cpp)
   
   초기화 단계:
   ├── bwgame::state 생성 (게임 상태)
   ├── bwgame::action_state 생성 (액션 상태)
   ├── game_state 초기화 (게임 로직)
   ├── player_input_handler 초기화 (입력 처리)
   └── ui_functions 초기화 (UI 렌더링)
   
   게임 루프:
   ├── 이벤트 처리
   │   ├── 키보드/마우스 입력
   │   ├── 윈도우 이벤트
   │   └── 종료 이벤트
   │
   ├── 입력 업데이트
   │   ├── 부드러운 스크롤
   │   ├── 유닛 선택
   │   └── 명령 실행
   │
   ├── 게임 상태 업데이트
   │   ├── 유닛 업데이트
   │   ├── 건물 업데이트
   │   └── 자원 업데이트
   │
   ├── UI 렌더링
   │   ├── 게임 화면 렌더링
   │   ├── 스타크래프트 UI 패널
   │   └── 화면 갱신
   │
   └── 프레임 레이트 제한 (60 FPS)

3. 게임 로직 흐름 (game_logic.cpp)
   
   game_state::update()
   ├── update_game_logic()
   │   ├── 프레임 카운터 증가
   │   └── 승리/패배 조건 확인
   │
   ├── update_units()
   │   ├── 모든 유닛 순회
   │   ├── 이동 처리
   │   ├── 공격 처리
   │   └── 애니메이션 업데이트
   │
   ├── update_buildings()
   │   ├── 모든 건물 순회
   │   ├── 생산 처리
   │   ├── 업그레이드 처리
   │   └── 리페어 처리
   │
   └── update_resources()
       ├── 미네랄 수집
       ├── 가스 수집
       └── 서플라이 계산

4. 입력 처리 흐름 (player_input.cpp)
   
   handle_event()
   ├── 마우스 이동
   │   ├── 월드 좌표 변환
   │   ├── 건물 미리보기 업데이트
   │   └── 드래그 감지
   │
   ├── 마우스 클릭
   │   ├── 좌클릭: 유닛 선택
   │   │   ├── 단일 선택
   │   │   ├── 다중 선택 (Shift)
   │   │   └── 드래그 선택
   │   │
   │   └── 우클릭: 명령 실행
   │       ├── 이동 명령
   │       ├── 공격 명령
   │       └── 수집 명령
   │
   └── 키보드 입력
       ├── Shift/Ctrl 상태 추적
       ├── ESC: 취소
       └── 단축키 처리

5. UI 렌더링 흐름 (ui_starcraft_panel.h)
   
   render_starcraft_ui_panel()
   ├── 하단 패널 배경 (160px 높이)
   │   └── 검은색 배경 + 테두리
   │
   ├── 좌측: 미니맵 (128x128)
   │   ├── 미니맵 배경
   │   ├── 3D 테두리
   │   └── 레이블
   │
   ├── 중앙: 유닛 정보 (200x144)
   │   ├── 초상화 영역
   │   ├── HP/Shield/Energy 표시
   │   └── 3D 테두리
   │
   ├── 우측: 커맨드 카드 (3x3 버튼)
   │   ├── 버튼 그리드
   │   ├── 각 버튼 3D 효과
   │   └── 단축키 표시
   │
   └── 최우측: 자원 정보
       ├── 미네랄 (청록색)
       ├── 가스 (청록색)
       └── 서플라이 (노란색)

6. UI 폴더 구조 (ui/)
   
   ui/ui.h
   ├── 타일셋 렌더링
   ├── 스프라이트 렌더링
   ├── 이미지 로딩
   └── 사운드 재생
   
   ui/sdl2.cpp
   ├── SDL2 윈도우 관리
   ├── 이벤트 처리
   ├── 서페이스 렌더링
   └── 사운드 믹싱
   
   ui/native_window.h
   ├── 윈도우 추상화
   ├── 이벤트 타입 정의
   └── 입력 상태 관리

7. 데이터 흐름
   
   사용자 입력
   ↓
   native_window::event_t
   ↓
   player_input_handler::handle_event()
   ↓
   action_state (선택, 명령)
   ↓
   game_state::update()
   ↓
   bwgame::state (게임 상태)
   ↓
   ui_functions::update()
   ↓
   render_starcraft_ui_panel()
   ↓
   SDL2 윈도우 서페이스
   ↓
   화면 출력

8. 주요 데이터 구조
   
   bwgame::state
   ├── visible_units (보이는 유닛 목록)
   ├── buildings (건물 목록)
   ├── tiles (맵 타일 데이터)
   ├── current_frame (현재 프레임)
   └── players (플레이어 정보)
   
   action_state
   ├── selection (선택된 유닛)
   ├── selected_units (플레이어별 선택)
   └── 명령 큐
   
   player_input_handler
   ├── mouse_pos (마우스 위치)
   ├── command_mode (명령 모드)
   ├── building_to_place (건설할 건물)
   └── shift_pressed, ctrl_pressed

9. 렌더링 파이프라인
   
   게임 화면 렌더링
   ├── 타일 렌더링 (지형)
   ├── 유닛 렌더링 (스프라이트)
   ├── 이펙트 렌더링
   └── UI 오버레이
   
   UI 패널 렌더링
   ├── 픽셀 버퍼 잠금
   ├── 직접 픽셀 쓰기
   │   ├── fill_rect() - 사각형 채우기
   │   ├── draw_3d_border() - 3D 테두리
   │   └── draw_text5x7() - 텍스트 렌더링
   └── 픽셀 버퍼 잠금 해제

10. 빌드 프로세스
    
    빌드_최종.bat
    ├── g++ 컴파일러 자동 탐지
    ├── SDL2 경로 자동 탐지
    ├── 컴파일 옵션
    │   ├── -std=c++17
    │   ├── -O2 (최적화)
    │   ├── -DOPENBW_ENABLE_UI
    │   └── -static-libgcc -static-libstdc++
    └── 링크 라이브러리
        ├── SDL2main
        ├── SDL2
        └── mingw32

11. 주요 개선 사항
    
    ✓ 스타크래프트 스타일 UI 패널 추가
    ├── 하단 160px 패널
    ├── 미니맵 (128x128)
    ├── 유닛 정보 패널
    ├── 3x3 커맨드 카드
    └── 자원 표시
    
    ✓ 3D 효과 테두리
    ├── 밝은/어두운 색상 조합
    └── raised/sunken 스타일
    
    ✓ 커스텀 폰트 렌더링
    ├── 5x7 비트맵 폰트
    ├── 스케일링 지원
    └── 색상 지정 가능

12. 향후 개선 방향
    
    □ 실제 게임 데이터 연동
    ├── 실시간 자원 표시
    ├── 선택된 유닛 정보
    └── 사용 가능한 명령 표시
    
    □ 미니맵 기능
    ├── 맵 렌더링
    ├── 유닛 위치 표시
    └── 클릭으로 화면 이동
    
    □ 커맨드 카드 기능
    ├── 유닛별 명령 표시
    ├── 클릭 이벤트 처리
    └── 단축키 지원
    
    □ 애니메이션 효과
    ├── 버튼 호버 효과
    ├── 클릭 피드백
    └── 부드러운 전환

========================================
